name: Count and Update Graphic Files

on:
  schedule:
    - cron: '0 2 * * 1'  # Every Monday at 02:00 UTC
  workflow_dispatch:  # Allows manual trigger

jobs:
  count-graphic-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Configure Git to handle large pushes
        run: |
          git config --global http.postBuffer 524288000  # Increase buffer size to 500MB

      - name: Pull the latest changes
        run: |
          git fetch --all
          git reset --hard origin/main || echo "No changes to pull"

      - name: Count graphic files and update number
        run: |
          # Count the graphic files (png, jpg, gif, svg, etc.)
          GRAPHIC_COUNT=$(find . -type f \( -iname "*.png" -o -iname "*.jpg" -o -iname "*.gif" -o -iname "*.svg" \) | wc -l)

          # Define the file name
          FILE_NAME="NumberPicons_${GRAPHIC_COUNT}.txt"
          
          # Create the file with the graphic count in the root folder
          echo "Number of graphic files: $GRAPHIC_COUNT" > $FILE_NAME
          
          # List files to confirm that the file was created
          ls -l .  # List all files in the root directory to verify the file creation
          
          # Update README with the number of graphic files
          sed -i "s/Number of graphic files:.*/Number of graphic files: $GRAPHIC_COUNT/" README.md || echo "Number of graphic files: $GRAPHIC_COUNT" >> README.md

      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"

          # Add the updated files (README and the correctly named NumberPicons txt)
          git add README.md $FILE_NAME

          # Commit the changes
          git commit -m "Updated number of graphic files in README and $FILE_NAME"

          # Push the changes
          git push --force
